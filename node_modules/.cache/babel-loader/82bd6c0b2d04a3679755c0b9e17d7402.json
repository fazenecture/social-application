{"ast":null,"code":"import _objectSpread from \"/Users/vivekkumarsingh/Drive/Random/Github/social-application/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _classCallCheck from \"/Users/vivekkumarsingh/Drive/Random/Github/social-application/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/vivekkumarsingh/Drive/Random/Github/social-application/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _inherits from \"/Users/vivekkumarsingh/Drive/Random/Github/social-application/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/vivekkumarsingh/Drive/Random/Github/social-application/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nvar _jsxFileName = \"/Users/vivekkumarsingh/Drive/Random/Github/social-application/src/App.js\";\nimport React, { Component, Fragment } from 'react';\nimport { Route, Switch, Redirect, withRouter } from 'react-router-dom';\nimport Layout from './components/Layout/Layout';\nimport Backdrop from './components/Backdrop/Backdrop';\nimport Toolbar from './components/Toolbar/Toolbar';\nimport MainNavigation from './components/Navigation/MainNavigation/MainNavigation';\nimport MobileNavigation from './components/Navigation/MobileNavigation/MobileNavigation';\nimport ErrorHandler from './components/ErrorHandler/ErrorHandler';\nimport FeedPage from './pages/Feed/Feed';\nimport SinglePostPage from './pages/Feed/SinglePost/SinglePost';\nimport LoginPage from './pages/Auth/Login';\nimport SignupPage from './pages/Auth/Signup';\nimport './App.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar App = /*#__PURE__*/function (_Component) {\n  _inherits(App, _Component);\n\n  var _super = _createSuper(App);\n\n  function App() {\n    var _this;\n\n    _classCallCheck(this, App);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n    _this.state = {\n      showBackdrop: false,\n      showMobileNav: false,\n      isAuth: true,\n      token: null,\n      userId: null,\n      authLoading: false,\n      error: null\n    };\n\n    _this.mobileNavHandler = function (isOpen) {\n      _this.setState({\n        showMobileNav: isOpen,\n        showBackdrop: isOpen\n      });\n    };\n\n    _this.backdropClickHandler = function () {\n      _this.setState({\n        showBackdrop: false,\n        showMobileNav: false,\n        error: null\n      });\n    };\n\n    _this.logoutHandler = function () {\n      _this.setState({\n        isAuth: false,\n        token: null\n      });\n\n      localStorage.removeItem('token');\n      localStorage.removeItem('expiryDate');\n      localStorage.removeItem('userId');\n    };\n\n    _this.loginHandler = function (event, authData) {\n      event.preventDefault();\n\n      _this.setState({\n        authLoading: true\n      });\n\n      fetch('URL').then(function (res) {\n        if (res.status === 422) {\n          throw new Error('Validation failed.');\n        }\n\n        if (res.status !== 200 && res.status !== 201) {\n          console.log('Error!');\n          throw new Error('Could not authenticate you!');\n        }\n\n        return res.json();\n      }).then(function (resData) {\n        console.log(resData);\n\n        _this.setState({\n          isAuth: true,\n          token: resData.token,\n          authLoading: false,\n          userId: resData.userId\n        });\n\n        localStorage.setItem('token', resData.token);\n        localStorage.setItem('userId', resData.userId);\n        var remainingMilliseconds = 60 * 60 * 1000;\n        var expiryDate = new Date(new Date().getTime() + remainingMilliseconds);\n        localStorage.setItem('expiryDate', expiryDate.toISOString());\n\n        _this.setAutoLogout(remainingMilliseconds);\n      }).catch(function (err) {\n        console.log(err);\n\n        _this.setState({\n          isAuth: false,\n          authLoading: false,\n          error: err\n        });\n      });\n    };\n\n    _this.signupHandler = function (event, authData) {\n      event.preventDefault();\n\n      _this.setState({\n        authLoading: true\n      });\n\n      fetch('URL').then(function (res) {\n        if (res.status === 422) {\n          throw new Error(\"Validation failed. Make sure the email address isn't used yet!\");\n        }\n\n        if (res.status !== 200 && res.status !== 201) {\n          console.log('Error!');\n          throw new Error('Creating a user failed!');\n        }\n\n        return res.json();\n      }).then(function (resData) {\n        console.log(resData);\n\n        _this.setState({\n          isAuth: false,\n          authLoading: false\n        });\n\n        _this.props.history.replace('/');\n      }).catch(function (err) {\n        console.log(err);\n\n        _this.setState({\n          isAuth: false,\n          authLoading: false,\n          error: err\n        });\n      });\n    };\n\n    _this.setAutoLogout = function (milliseconds) {\n      setTimeout(function () {\n        _this.logoutHandler();\n      }, milliseconds);\n    };\n\n    _this.errorHandler = function () {\n      _this.setState({\n        error: null\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var token = localStorage.getItem('token');\n      var expiryDate = localStorage.getItem('expiryDate');\n\n      if (!token || !expiryDate) {\n        return;\n      }\n\n      if (new Date(expiryDate) <= new Date()) {\n        this.logoutHandler();\n        return;\n      }\n\n      var userId = localStorage.getItem('userId');\n      var remainingMilliseconds = new Date(expiryDate).getTime() - new Date().getTime();\n      this.setState({\n        isAuth: true,\n        token: token,\n        userId: userId\n      });\n      this.setAutoLogout(remainingMilliseconds);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var routes = /*#__PURE__*/_jsxDEV(Switch, {\n        children: [/*#__PURE__*/_jsxDEV(Route, {\n          path: \"/\",\n          exact: true,\n          render: function render(props) {\n            return /*#__PURE__*/_jsxDEV(LoginPage, _objectSpread(_objectSpread({}, props), {}, {\n              onLogin: _this2.loginHandler,\n              loading: _this2.state.authLoading\n            }), void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 148,\n              columnNumber: 13\n            }, _this2);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 144,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(Route, {\n          path: \"/signup\",\n          exact: true,\n          render: function render(props) {\n            return /*#__PURE__*/_jsxDEV(SignupPage, _objectSpread(_objectSpread({}, props), {}, {\n              onSignup: _this2.signupHandler,\n              loading: _this2.state.authLoading\n            }), void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 159,\n              columnNumber: 13\n            }, _this2);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(Redirect, {\n          to: \"/\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 166,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 7\n      }, this);\n\n      if (this.state.isAuth) {\n        routes = /*#__PURE__*/_jsxDEV(Switch, {\n          children: [/*#__PURE__*/_jsxDEV(Route, {\n            path: \"/\",\n            exact: true,\n            render: function render(props) {\n              return /*#__PURE__*/_jsxDEV(FeedPage, {\n                userId: _this2.state.userId,\n                token: _this2.state.token\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 176,\n                columnNumber: 15\n              }, _this2);\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 172,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            path: \"/:postId\",\n            render: function render(props) {\n              return /*#__PURE__*/_jsxDEV(SinglePostPage, _objectSpread(_objectSpread({}, props), {}, {\n                userId: _this2.state.userId,\n                token: _this2.state.token\n              }), void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 182,\n                columnNumber: 15\n              }, _this2);\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 179,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(Redirect, {\n            to: \"/\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 189,\n            columnNumber: 11\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 9\n        }, this);\n      }\n\n      return /*#__PURE__*/_jsxDEV(Fragment, {\n        children: [this.state.showBackdrop && /*#__PURE__*/_jsxDEV(Backdrop, {\n          onClick: this.backdropClickHandler\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(ErrorHandler, {\n          error: this.state.error,\n          onHandle: this.errorHandler\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 198,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(Layout, {\n          header: /*#__PURE__*/_jsxDEV(Toolbar, {\n            children: /*#__PURE__*/_jsxDEV(MainNavigation, {\n              onOpenMobileNav: this.mobileNavHandler.bind(this, true),\n              onLogout: this.logoutHandler,\n              isAuth: this.state.isAuth\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 202,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 201,\n            columnNumber: 13\n          }, this),\n          mobileNav: /*#__PURE__*/_jsxDEV(MobileNavigation, {\n            open: this.state.showMobileNav,\n            mobile: true,\n            onChooseItem: this.mobileNavHandler.bind(this, false),\n            onLogout: this.logoutHandler,\n            isAuth: this.state.isAuth\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 210,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 9\n        }, this), routes]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 7\n      }, this);\n    }\n  }]);\n\n  return App;\n}(Component);\n\nexport default _c = withRouter(App);\n\nvar _c;\n\n$RefreshReg$(_c, \"%default%\");","map":{"version":3,"sources":["/Users/vivekkumarsingh/Drive/Random/Github/social-application/src/App.js"],"names":["React","Component","Fragment","Route","Switch","Redirect","withRouter","Layout","Backdrop","Toolbar","MainNavigation","MobileNavigation","ErrorHandler","FeedPage","SinglePostPage","LoginPage","SignupPage","App","state","showBackdrop","showMobileNav","isAuth","token","userId","authLoading","error","mobileNavHandler","isOpen","setState","backdropClickHandler","logoutHandler","localStorage","removeItem","loginHandler","event","authData","preventDefault","fetch","then","res","status","Error","console","log","json","resData","setItem","remainingMilliseconds","expiryDate","Date","getTime","toISOString","setAutoLogout","catch","err","signupHandler","props","history","replace","milliseconds","setTimeout","errorHandler","getItem","routes","bind"],"mappings":"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","sourcesContent":["import React, { Component, Fragment } from 'react';\nimport { Route, Switch, Redirect, withRouter } from 'react-router-dom';\n\nimport Layout from './components/Layout/Layout';\nimport Backdrop from './components/Backdrop/Backdrop';\nimport Toolbar from './components/Toolbar/Toolbar';\nimport MainNavigation from './components/Navigation/MainNavigation/MainNavigation';\nimport MobileNavigation from './components/Navigation/MobileNavigation/MobileNavigation';\nimport ErrorHandler from './components/ErrorHandler/ErrorHandler';\nimport FeedPage from './pages/Feed/Feed';\nimport SinglePostPage from './pages/Feed/SinglePost/SinglePost';\nimport LoginPage from './pages/Auth/Login';\nimport SignupPage from './pages/Auth/Signup';\nimport './App.css';\n\nclass App extends Component {\n  state = {\n    showBackdrop: false,\n    showMobileNav: false,\n    isAuth: true,\n    token: null,\n    userId: null,\n    authLoading: false,\n    error: null\n  };\n\n  componentDidMount() {\n    const token = localStorage.getItem('token');\n    const expiryDate = localStorage.getItem('expiryDate');\n    if (!token || !expiryDate) {\n      return;\n    }\n    if (new Date(expiryDate) <= new Date()) {\n      this.logoutHandler();\n      return;\n    }\n    const userId = localStorage.getItem('userId');\n    const remainingMilliseconds =\n      new Date(expiryDate).getTime() - new Date().getTime();\n    this.setState({ isAuth: true, token: token, userId: userId });\n    this.setAutoLogout(remainingMilliseconds);\n  }\n\n  mobileNavHandler = isOpen => {\n    this.setState({ showMobileNav: isOpen, showBackdrop: isOpen });\n  };\n\n  backdropClickHandler = () => {\n    this.setState({ showBackdrop: false, showMobileNav: false, error: null });\n  };\n\n  logoutHandler = () => {\n    this.setState({ isAuth: false, token: null });\n    localStorage.removeItem('token');\n    localStorage.removeItem('expiryDate');\n    localStorage.removeItem('userId');\n  };\n\n  loginHandler = (event, authData) => {\n    event.preventDefault();\n    this.setState({ authLoading: true });\n    fetch('URL')\n      .then(res => {\n        if (res.status === 422) {\n          throw new Error('Validation failed.');\n        }\n        if (res.status !== 200 && res.status !== 201) {\n          console.log('Error!');\n          throw new Error('Could not authenticate you!');\n        }\n        return res.json();\n      })\n      .then(resData => {\n        console.log(resData);\n        this.setState({\n          isAuth: true,\n          token: resData.token,\n          authLoading: false,\n          userId: resData.userId\n        });\n        localStorage.setItem('token', resData.token);\n        localStorage.setItem('userId', resData.userId);\n        const remainingMilliseconds = 60 * 60 * 1000;\n        const expiryDate = new Date(\n          new Date().getTime() + remainingMilliseconds\n        );\n        localStorage.setItem('expiryDate', expiryDate.toISOString());\n        this.setAutoLogout(remainingMilliseconds);\n      })\n      .catch(err => {\n        console.log(err);\n        this.setState({\n          isAuth: false,\n          authLoading: false,\n          error: err\n        });\n      });\n  };\n\n  signupHandler = (event, authData) => {\n    event.preventDefault();\n    this.setState({ authLoading: true });\n    fetch('URL')\n      .then(res => {\n        if (res.status === 422) {\n          throw new Error(\n            \"Validation failed. Make sure the email address isn't used yet!\"\n          );\n        }\n        if (res.status !== 200 && res.status !== 201) {\n          console.log('Error!');\n          throw new Error('Creating a user failed!');\n        }\n        return res.json();\n      })\n      .then(resData => {\n        console.log(resData);\n        this.setState({ isAuth: false, authLoading: false });\n        this.props.history.replace('/');\n      })\n      .catch(err => {\n        console.log(err);\n        this.setState({\n          isAuth: false,\n          authLoading: false,\n          error: err\n        });\n      });\n  };\n\n  setAutoLogout = milliseconds => {\n    setTimeout(() => {\n      this.logoutHandler();\n    }, milliseconds);\n  };\n\n  errorHandler = () => {\n    this.setState({ error: null });\n  };\n\n  render() {\n    let routes = (\n      <Switch>\n        <Route\n          path=\"/\"\n          exact\n          render={props => (\n            <LoginPage\n              {...props}\n              onLogin={this.loginHandler}\n              loading={this.state.authLoading}\n            />\n          )}\n        />\n        <Route\n          path=\"/signup\"\n          exact\n          render={props => (\n            <SignupPage\n              {...props}\n              onSignup={this.signupHandler}\n              loading={this.state.authLoading}\n            />\n          )}\n        />\n        <Redirect to=\"/\" />\n      </Switch>\n    );\n    if (this.state.isAuth) {\n      routes = (\n        <Switch>\n          <Route\n            path=\"/\"\n            exact\n            render={props => (\n              <FeedPage userId={this.state.userId} token={this.state.token} />\n            )}\n          />\n          <Route\n            path=\"/:postId\"\n            render={props => (\n              <SinglePostPage\n                {...props}\n                userId={this.state.userId}\n                token={this.state.token}\n              />\n            )}\n          />\n          <Redirect to=\"/\" />\n        </Switch>\n      );\n    }\n    return (\n      <Fragment>\n        {this.state.showBackdrop && (\n          <Backdrop onClick={this.backdropClickHandler} />\n        )}\n        <ErrorHandler error={this.state.error} onHandle={this.errorHandler} />\n        <Layout\n          header={\n            <Toolbar>\n              <MainNavigation\n                onOpenMobileNav={this.mobileNavHandler.bind(this, true)}\n                onLogout={this.logoutHandler}\n                isAuth={this.state.isAuth}\n              />\n            </Toolbar>\n          }\n          mobileNav={\n            <MobileNavigation\n              open={this.state.showMobileNav}\n              mobile\n              onChooseItem={this.mobileNavHandler.bind(this, false)}\n              onLogout={this.logoutHandler}\n              isAuth={this.state.isAuth}\n            />\n          }\n        />\n        {routes}\n      </Fragment>\n    );\n  }\n}\n\nexport default withRouter(App);\n"]},"metadata":{},"sourceType":"module"}